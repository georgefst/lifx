I inherited this work from someone else. A major rewrite is on the way.
